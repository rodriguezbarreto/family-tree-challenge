## Family tree challenge

### DescriÃ§Ã£o

Este repositÃ³rio contÃ©m uma API escrita em Golang que criar e gerenciar uma Ã¡rvore genealÃ³gica.

### PrÃ©-requisitos

- Docker (https://docs.docker.com/get-docker/)
- Docker Compose (https://docs.docker.com/compose/install/)

### Como rodar a aplicaÃ§Ã£o

1. Clone o repositÃ³rio para sua mÃ¡quina local:
   ```shell
   git clone https://github.com/rodriguezbarreto/family-tree-challenge
   cd family-tree-challenge
   ```
   
2. Construa a imagem Docker da API:

    ```shell
    docker build -t family-tree-challenge .
    ```

3. Inicie a aplicaÃ§Ã£o e o banco de dados com o Docker Compose:

    ```shell
   docker-compose up -d
    ```
    Este comando iniciarÃ¡ dois contÃªineres, um para a API e outro para o banco de dados PostgreSQL.

4. Acesse a API no seu navegador ou com um cliente HTTP, como o curl:

    ```shell
    curl http://localhost:8080
    ```

5. Se vocÃª quiser interromper e remover os contÃªineres, use o seguinte comando:

    ```shell
   docker-compose down
    ```

6. HÃ¡ um arquivo para preencher o banco de dados com algumas informaÃ§Ãµes. Siga as instruÃ§Ãµes a seguir para semear o banco de dados:

    ```shell
   cd cmd/seed
   go run seed.go
    ```

### Estrutura de pastas

    â”œâ”€â”€ğŸ“ cmd
    â”‚Â Â  â”œâ”€â”€ğŸ“configs
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ seed-database.go
    â”‚Â Â  â”‚Â Â  â””â”€â”€ setup-middlewares.go
    â”‚Â Â  â”œâ”€â”€ğŸ“ enpoints
    â”‚Â Â  â”‚Â Â  â””â”€â”€ setup-endpoints.go
    â”‚Â Â  â”œâ”€â”€ğŸ“ seed
    |   |   â””â”€â”€ seed.go
    â”‚Â Â  â””â”€â”€ main.go
    â”œâ”€â”€ğŸ“ internal
    â”‚Â Â  â”œâ”€â”€ğŸ“ domain
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ğŸ“ errors
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ validator.go
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ğŸ“ tests
    â”‚Â Â  â”‚Â Â  |   â”œâ”€â”€ person_test.go
    â”‚Â Â  â”‚Â Â  |   â””â”€â”€ relationship_test.go
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€relationship.go
    â”‚Â Â  â”‚Â Â  â””â”€â”€person.go
    â”‚Â Â  â”œâ”€â”€ğŸ“ infra
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ğŸ“ controllers
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ create-person-controller.go
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ create-relationship-controller.go
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ delete-person-controller.go
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ delete-relationship-controller.go
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ get-bacon-number-controller.go
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ get-genealogy-controller.go
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ list-person-controller.go
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ list-relationship-controller.go
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ update-person controller.go
    â”‚Â Â  â”‚Â Â  â”œâ”€â”€ğŸ“ database
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ postgres-connection.go
    â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ğŸ“ repositories
    â”‚Â Â  â”‚Â Â  â”‚Â Â      â”œâ”€â”€ person-repository.go
    â”‚Â Â  â”‚Â Â  â”‚Â Â      â””â”€â”€ relationship-repository.go
    â”‚Â Â  â”‚Â Â  â””â”€â”€ğŸ“ factories
    â”‚Â Â  â”‚Â Â      â”œâ”€â”€ bacon-number-facotry.go
    â”‚Â Â  â”‚Â Â      â”œâ”€â”€ create-person-factory.go
    â”‚Â Â  â”‚Â Â      â”œâ”€â”€ create-relationship-factory.go
    â”‚Â Â  â”‚Â Â      â”œâ”€â”€ delete-person-factory.go
    â”‚Â Â  â”‚Â Â      â”œâ”€â”€ delete-relationship.go
    â”‚Â Â  â”‚Â Â      â”œâ”€â”€ get-genealogy-factory.go
    â”‚Â Â  â”‚Â Â      â”œâ”€â”€ list-person-factory.go
    â”‚Â Â  â”‚Â Â      â”œâ”€â”€ list-relationship-factory.go
    â”‚Â Â  â”‚Â Â      â”œâ”€â”€ person-repository-factory.go
    â”‚Â Â  â”‚Â Â      â”œâ”€â”€ relationship-repository-factory.go
    â”‚Â Â  â”‚Â Â      â””â”€â”€ update-person-factory.go
    â”‚Â Â  â””â”€â”€ğŸ“ use-cases
    â”‚Â Â      â”œâ”€â”€ğŸ“ dto
    â”‚Â Â      â”‚Â Â  â”œâ”€â”€ genealogy-dto.go
    â”‚Â Â      â”‚Â Â  â”œâ”€â”€ person-dto.go
    â”‚Â Â      â”‚Â Â  â””â”€â”€ relationship-dto.go
    â”‚Â Â      â”œâ”€â”€ğŸ“ repositories
    â”‚Â Â      â”‚Â Â  â”œâ”€â”€ person-repository.go
    â”‚Â Â      â”‚Â Â  â””â”€â”€ relationship-repository.go
    |       â”œâ”€â”€ğŸ“ tests
    â”‚Â Â      â”‚Â Â  â”œâ”€â”€ create_person_test.go
    â”‚Â Â      â”‚Â Â  â”œâ”€â”€ create_relationship_test.go
    â”‚Â Â      â”‚Â Â  â”œâ”€â”€ delete_person_test.go
    â”‚Â Â      â”‚Â Â  â”œâ”€â”€ delete_relationship_test.go
    â”‚Â Â      â”‚Â Â  â”œâ”€â”€ list_person_test.go
    â”‚Â Â      â”‚Â Â  â”œâ”€â”€ list_relationship_test.go
    â”‚Â Â      â”‚Â Â  â”œâ”€â”€ mock_test.go
    â”‚Â Â      â”‚Â Â  â””â”€â”€ update_person_test.go
    â”‚Â Â      â”œâ”€â”€ create-person.go
    â”‚Â Â      â”œâ”€â”€ create-relationship.go
    â”‚Â Â      â”œâ”€â”€ delete-person.go
    â”‚Â Â      â”œâ”€â”€ delete-relationship.go
    â”‚Â Â      â”œâ”€â”€ get-bacon-number.go
    â”‚Â Â      â”œâ”€â”€ get-genealogy.go
    â”‚Â Â      â”œâ”€â”€ list-person.go
    â”‚Â Â      â”œâ”€â”€ list-relationship.go
    â”‚Â Â      â””â”€â”€ update-person.go
    |
    â”œâ”€â”€ docker-compose.yml
    â”œâ”€â”€ Dockerfile
    â”œâ”€â”€ go.mod
    â”œâ”€â”€ go.sum
    â””â”€â”€ README.MD

<br>

### Endpoints


---
>### Persons
#### POST `/persons`

Create Person

- **Request Body:** JSON
    ```Json
    {
        "name": "Daniel"
    }
    ```

- **Response:**
  - **HTTP 201**: Pessoa criada com sucesso
  - **HTTP 400**: RequisiÃ§Ã£o invÃ¡lida.
  - **HTTP 500**: Erro interno do servidor.

<br>

---

#### GET `/persons/{id}`

List Persons by ID

- **Parameters:** 
    + **`id`** (int, path, obrigatÃ³rio): ID da `Person`.
- **Response Body:** JSON
    ```Json
    {
        "id": "7f272309-bd0b-4cf3-8c09-81391ba2d2df",
        "name": "Sonny"
    }
    ```
- **Status Response:**
    - **HTTP 200**: Retorna JSON com informaÃ§Ãµes da pessoa.
    - **HTTP 404**: Pessoa nÃ£o encontrada.
    - **HTTP 400**: RequisiÃ§Ã£o invÃ¡lida.
    - **HTTP 500**: Erro interno do servidor.

<br>

---

#### GET `/persons`

List all Persons

- **Response Body:** JSON
    ```Json
    {
        "id": "3c8f6f29-9dab-4dfc-9fee-a93279865e89",
        "name": "Ann"
    },
    {
        "id": "d3ab4771-e066-4e26-b13e-986e92241601",
        "name": "Dunny"
    },
    {
        "id": "b1c6dd69-0abf-4aeb-ad48-9e838fd76d34",
        "name": "Bruce"
    },
    {
        "id": "bc1afa20-a896-4085-9700-44f7eb74106a",
        "name": "Advick"
    }
    ```

- **Status Response:**
    - **HTTP 200**: Retorna JSON com informaÃ§Ãµes das pessoas.
    - **HTTP 500**: Erro interno do servidor.

<br>

---

#### PUT `/persons/{id}`

Update Person

- **Parameters:**
  - `id` (int, path, obrigatÃ³rio): ID da pessoa.
- **Request Body:** JSON
    ```Json
    {
        "name": "Sonny"
    }
    ```
- **Status Response:**
    - **HTTP 201**: Pessoa atualizada com sucesso
    - **HTTP 404**: Pessoa nÃ£o encontrada.
    - **HTTP 400**: RequisiÃ§Ã£o invÃ¡lida.
    - **HTTP 500**: Erro interno do servidor

<br>

---

#### DELETE `/persons/{id}`

Delete Person

- **Parameters:** 
  - `id` (int, path, obrigatÃ³rio): ID da pessoa.
- **Status Response:**
    - **HTTP 204**: Pessoa Deletada com sucesso.
    - **HTTP 400**: RequisiÃ§Ã£o invÃ¡lida.
    - **HTTP 500**: Erro interno do servidor

<br>

---
>### Reelationships

Create Relationship

- **Request Body:** JSON
    ```Json
    {
        "child": "da2e1e9a-0d12-4506-93e1-833d6887a83f",
        "parent": "23dc076d-8eed-4349-bffa-e0fcce80d5f1"
    }
    ```
- **Response:**
  - **HTTP 201**: Relacionamento criado com sucesso.
  - **HTTP 400**: RequisiÃ§Ã£o invÃ¡lida.
  - **HTTP 500**: Erro interno do servidor.

<br>

---
#### GET `/relationships`

List all Relationship.

- **Parameters:** 
  - `relId` (query string): Filtra relacionamento por ID
  - `childId` (query string): Filtra todos relacionamentos na condiÃ§Ã£o de filho
  - `parentId` (query string): Filtra todos relacionamentos na condiÃ§Ã£o de pai

  <br>

- **Response Body:** JSON
    ```Json
    [
       {
            "id": "4a82227b-c64b-462e-87de-6b3a49521231",
            "child_id": "3c8f6f29-9dab-4dfc-9fee-a93279865e89",
            "parent_id": "7f272309-bd0b-4cf3-8c09-81391ba2d2df",
            "child": {
                "id": "3c8f6f29-9dab-4dfc-9fee-a93279865e89",
                "name": "Ann"
            },
            "parent": {
                "id": "7f272309-bd0b-4cf3-8c09-81391ba2d2df",
                "name": "Sonny"
            }
        },
        {
            "id": "93ca5dc7-c45f-4c37-951d-56bd8e3be415",
            "child_id": "6ea48a6b-283d-4832-a60c-70c6d834b79e",
            "parent_id": "da6e7212-4f6a-4c3e-adf8-8aa443006df4",
            "child": {
                "id": "6ea48a6b-283d-4832-a60c-70c6d834b79e",
                "name": "Phoebe"
            },
            "parent": {
                "id": "da6e7212-4f6a-4c3e-adf8-8aa443006df4",
                "name": "Martin"
            }
        },
    ]
    ```

- **Status Response:**
  - **HTTP 200**: Retorna JSON com uma lista de relacionamentos.
  - **HTTP 500**: Erro interno do servidor.

<br>

---
>### Genealogy

#### GET `/genealogy/{id}`

Get Genealogy.

- **Parameters:** 
  - `id` (int, path, obrigatÃ³rio): ID da pessoa.

- **Response Body:** JSON
    ```Json
   {
        "members": [
            {
                "name": "Phoebe",
                "relationships": [
                    {
                        "name": "Martin",
                        "relationship": "parent"
                    },
                    {
                        "name": "Anastasia",
                        "relationship": "parent"
                    }
                ]
            },
            {
                "name": "Anastasia",
                "relationships": []
            },
            {
                "name": "Martin",
                "relationships": []
            },
            {
                "name": "Bruce",
                "relationships": [
                    {
                        "name": "Phoebe",
                        "relationship": "parent"
                    }
                ]
            },
            {
                "name": "Dunny",
                "relationships": [
                    {
                        "name": "Phoebe",
                        "relationship": "parent"
                    }
                ]
            },
            {
                "name": "Clark",
                "relationships": [
                    {
                        "name": "Anastasia",
                        "relationship": "parent"
                    }
                ]
            }
        ]
    }
    ```
- **Status Response:**
  - **HTTP 200**: Retorna JSON com a Ã¡rvore genealÃ³gica.
  - **HTTP 404**: Pessoa nÃ£o encontrada.
  - **HTTP 500**: Erro interno do servidor.

<br>

---
#### GET `/genealogy/bacon-number`

Get Bacon Number.

- **Request Body:** JSON
    ```Json
    {
        "sourceId": "b1c6dd69-0abf-4aeb-ad48-9e838fd76d34",
        "targetId": "401244a0-cc21-46e9-a1b8-27067d4da7c0"
    }
    ```

- **Response Body:** JSON
    ```Json
    {
        "baconNumber": "4"
    }   
    ```

- **Status Response:**
  - **HTTP 200**: Retorna JSON com o Bacon Number.
  - **HTTP 500**: Erro interno do servidor.